<!DOCTYPE html>
<!--
This page is for watching times, using CSS3
-->
<html>
    <head>
        <title>Class Clock</title>
        <link rel="stylesheet" type="text/css" href="EventStyles.css">
        <style>
            td
            {
                border: solid;
                padding: 10px 10px 10px 10px;
                font-size: 30pt;
            }
            
            div.time
            {
                font-size: 15pt;
            }
            
            div.title
            {
                font-size: 20pt;
            }
            
            canvas
            {
                border: solid;
                display: block;
                margin: 0 auto;
            }
        </style>
        
        <script src="EventFactory2.js" async></script>
    </head>

    <body>
        <p>
            <div align="center" id="title" class="title"></div>
            <div align="center" id="Main"></div>
        </p>
        
        <table align="center">
            <tbody>
                <tr>
                    <td></td>
                    <td><b>1st</b><div class="time" value=0>8:05am-8:55am</div></td>
                    <td><b>2nd</b><div class="time" value=1>9:00am-9:50am</div></td>
                    <td><b>3rd</b><div class="time" value=2>9:55am-10:45am</div></td>
                    <td><b>4th</b><div class="time" value=3>10:50am-11:40am</div></td>
                    <td><b>5th</b><div class="time" value=4>11:45am-12:35pm</div></td>
                    <td><b>6th</b><div class="time" value=5>12:40pm-1:30pm</div></td>
                    <td><b>7th</b><div class="time" value=6>1:35pm-2:25pm</div></td>
                    <td><b>8th</b><div class="time" value=7>2:30pm-3:20pm</div></td>
                    <td><b>9th</b><div class="time" value=8>3:25pm-4:15pm</div></td>
                    <td><b>10th</b><div class="time" value=9>4:20pm-5:10pm</div></td>
                </tr>
                <tr>
                    <td>Till Start</td>
                    <td><div id="0s" class="s" value=0></div></td>
                    <td><div id="1s" class="s" value=1></div></td>
                    <td><div id="2s" class="s" value=2></div></td>
                    <td><div id="3s" class="s" value=3></div></td>
                    <td><div id="4s" class="s" value=4></div></td>
                    <td><div id="5s" class="s" value=5></div></td>
                    <td><div id="6s" class="s" value=6></div></td>
                    <td><div id="7s" class="s" value=7></div></td>
                    <td><div id="8s" class="s" value=8></div></td>
                    <td><div id="9s" class="s" value=9></div></td>
                </tr>
                <tr>
                    <td>Till End</td>
                    <td><div id="0e" class="e" value=0></div></td>
                    <td><div id="1e" class="e" value=1></div></td>
                    <td><div id="2e" class="e" value=2></div></td>
                    <td><div id="3e" class="e" value=3></div></td>
                    <td><div id="4e" class="e" value=4></div></td>
                    <td><div id="5e" class="e" value=5></div></td>
                    <td><div id="6e" class="e" value=6></div></td>
                    <td><div id="7e" class="e" value=7></div></td>
                    <td><div id="8e" class="e" value=8></div></td>
                    <td><div id="9e" class="e" value=9></div></td>
                </tr>
            </tbody>
        </table>
        
        <script>

document.body.onload = initialize;

function timeTill(now, hour, minute){
    var curr = now.getHours()*3600 + now.getMinutes()*60 + now.getSeconds();
    var event = toSeconds([hour, minute, 0]);
    var diff = event - curr;
    var h = Math.floor(diff / 3600);
    diff -= h*3600;
    var m = Math.floor(diff/60);
    diff -= m*60;
    h += h < 0 ? 24 : 0;
    return [h, m, diff];
}

function toSeconds(stuff){
    return stuff[0]*3600+stuff[1]*60+stuff[2];
}

var timer;

var MainEvent;

function initialize(){
    
    /* */
    EventFactory.addEvent(8,5,"Start of First", false, document.getElementById("0s"));
    EventFactory.addEvent(8,55,"End of First", false, document.getElementById("0e"));
    EventFactory.addEvent(9,0,"Start of Second", false, document.getElementById("1s"));
    EventFactory.addEvent(9,50,"End of Second", false, document.getElementById("1e"));
    EventFactory.addEvent(9,55,"Start of Third", false, document.getElementById("2s"));
    EventFactory.addEvent(10,45,"End of Third", false, document.getElementById("2e"));
    EventFactory.addEvent(10,50,"Start of Fourth", false, document.getElementById("3s"));
    EventFactory.addEvent(11,40,"End of Fourth", false, document.getElementById("3e"));
    EventFactory.addEvent(11,45,"Start of Fifth", false, document.getElementById("4s"));
    EventFactory.addEvent(12,35,"End of Fifth", false, document.getElementById("4e"));
    EventFactory.addEvent(12,40,"Start of Sixth", false, document.getElementById("5s"));
    EventFactory.addEvent(1,30,"End of Sixth", true, document.getElementById("5e"));
    EventFactory.addEvent(1,35,"Start of Seventh", true, document.getElementById("6s"));
    EventFactory.addEvent(2,25,"End of Seventh", true, document.getElementById("6e"));
    EventFactory.addEvent(2,30,"Start of Eighth", true, document.getElementById("7s"));
    EventFactory.addEvent(3,20,"End of Eighth", true, document.getElementById("7e"));
    EventFactory.addEvent(3,25,"Start of Ninth", true, document.getElementById("8s"));
    EventFactory.addEvent(4,15,"End of Ninth", true, document.getElementById("8e"));
    EventFactory.addEvent(4,20,"Start of Tenth", true, document.getElementById("9s"));
    EventFactory.addEvent(5,10,"End of Tenth", true, document.getElementById("9e"));
    
    MainEvent = EventFactory.newEvent(0,0,"Main",false,document.getElementById('Main'));
    updateMainClockSize();
    
    
    updatePage();
    timer = window.setInterval(updatePage, 1000);
}

function windowHW() {
    return window.innerHeight>window.innerWidth?window.innerWidth:window.innerHeight;
}

function updateMainClockSize() {
    EventFactory.setSize(MainEvent, 0.9*windowHW());
}
window.onresize = updateMainClockSize;

function appendOrder(num){
    var ones = num-(Math.round(num/10)*10);
    return num + (ones==1?"st":ones==2?"nd":ones==3?"rd":"th");
}

function updatePage(){
    var now = new Date();
    EventFactory.updateAllEvents(now);
    updateMainEvent(now);
}

function fillTable(now){
    
    for (var i = 0; i < ends.length; i++){
        starts[i].innerHTML = parseToString(timeTill(now, classTimes[i][0][0], classTimes[i][0][1]));
        ends[i].innerHTML = parseToString(timeTill(now, classTimes[i][1][0], classTimes[i][1][1]));
    }
}

function parseToString(time){
    return ""+addZero(time[0])+":"+addZero(time[1])+":"+addZero(time[2]);
}

function addZero(num){
    return num<10?"0"+num:num;
}

function updateMainEvent(now){
    var till = EventFactory.timeTillNext(now);
    var since = EventFactory.timeSinceLast(now);
    var progress = since/(till+since);
    EventFactory.updateElement(MainEvent, progress);
    
    var t = EventFactory.toParts(till);
    EventFactory.setElementText(MainEvent, EventFactory.addZero(t[0]) + ":" +EventFactory.addZero(t[1]) + ":" +EventFactory.addZero(t[2]));
}




        </script>
    </body>
</html>
